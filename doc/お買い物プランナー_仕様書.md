# お買い物プランナー 仕様書

## 1. サービス概要
お買い物プランナーは、冷蔵庫などを確認しながら、買い物予定の
アイテムを簡単に登録できるシンプルなWebサービスである。  
スマートフォンでの操作を前提とし、デフォルトの買い物リストから
チェックするだけで、購入リストを作成・送信できる。

---

## 2. 利用想定
- 想定ユーザー：開発者本人のみ（ユーザー登録なし）
- 公開範囲：インターネット公開（Vercelで運用）
- アクセス制限：パスワード認証（`.env`管理）
- 使用デバイス：スマートフォン（レスポンシブ必須、PC対応は簡易）

---

## 3. 画面仕様
### 3.1 初期画面
- **構成**
  - タイトル：「お買い物プランナー」
  - パスワード入力欄（常に表示、クッキーがあれば値を自動入力）
  - デフォルトの買い物リスト（ハードコード・別ファイル管理）
    - 各項目にチェックボックス
  - 新規追加入力欄（テキストボックス）
  - 送信ボタン
- **動作**
  - チェックしたアイテム＋追加入力分をPOST送信
  - 成功時に「送信完了」メッセージを表示

### 3.2 スマホUI要件
- タップ操作を前提
- 大きめのチェックボックス
- フォントサイズ：16px以上
- ボタンは画面幅いっぱいに近いサイズ

---

## 4. 機能仕様
### 4.1 認証
- パスワード入力必須（毎回表示）
- クッキーで30日間保持（値を自動入力）
- サーバーで`.env`の値と一致確認

### 4.2 デフォルトアイテム
- ハードコードだが、別ファイル（例：`items.ts`）で定義
  ```ts
  // items.ts
  export const defaultItems = ["卵", "牛乳", "パン"];
  ```

### 4.3 アイテム追加
- テキストボックスで1件ずつ追加
- 数量・メモ欄なし

### 4.4 送信処理
- チェック済みアイテム＋追加アイテムをまとめて送信
- サーバーはパスワードを検証後、Webhookに転送
- 成功時に「送信完了」メッセージを表示

---

## 5. API仕様
### 5.1 フロント → サーバー
- **URL**：`/api/send-items`
- **メソッド**：POST
- **リクエスト**
  ```json
  {
    "password": "xxxx",
    "items": ["卵", "牛乳", "パン"]
  }
  ```
- **レスポンス**
  ```json
  {
    "status": "success"
  }
  ```

### 5.2 サーバー → Webhook
- **URL**：
  `https://n8n.smallpiece.jp/webhook-test/22c982ed-e621-45a3-b388-9cec1ff9b5ee`
- **メソッド**：POST
- **形式**：JSON
- **データ例**
  ```json
  {
    "items": ["卵", "牛乳", "パン"],
    "password": "xxxx"
  }
  ```

---

## 6. 認証・セキュリティ
- パスワードは`.env`で管理（例：`APP_PASSWORD=xxxx`）
- クッキー有効期限：30日
- HTTPS必須（Vercelにより対応）
- XSS/CSRF：
  - APIはPOSTのみ
  - JSONパース時のエスケープを実施

---

## 7. 開発構成
- **フレームワーク**：Next.js App Router
- **デプロイ**：Vercel
- **スタイル**：Tailwind CSS（予定）
- **DB**：なし（データは送信のみ）
- **パッケージ**
  - `next`, `react`, `tailwindcss`
- **構成**
  ```
  /app
    /page.tsx        # 初期画面
    /api/send-items  # APIエンドポイント
  /lib/items.ts      # デフォルトアイテム定義
  ```

## 8. 開発フェーズ
### フェーズ 1: MVP（最低限の機能）
**目的**：サービスの骨格を素早く完成させる

#### 作業内容
- **環境構築**
  - Next.js (App Router) プロジェクト作成
  - Tailwind CSS セットアップ
  - `.env` でパスワード設定
- **画面**
  - 初期画面に以下を配置
    - タイトル
    - パスワード入力欄（常時表示、クッキーで自動入力）
    - デフォルトアイテムリスト（別ファイルで管理）
    - アイテム追加テキストボックス
    - 送信ボタン
- **処理**
  - パスワード＋選択アイテム＋追加アイテムを API へ POST
  - API 側でパスワード検証し、Webhook へ転送
  - 成功時に「送信完了」メッセージを表示
- **レスポンシブ対応**
  - スマホ画面最適化
- **デプロイ**
  - Vercel へデプロイ

---

### フェーズ 2: UX 改善
**目的**：使いやすさを向上

#### 作業内容
- パスワード自動入力（クッキー保持）
- アイテム追加時、入力欄をクリア
- 成功/エラーのメッセージ表示改善（例：Toast）

---

### フェーズ 3: セキュリティ強化
**目的**：公開環境での安全性確保

#### 作業内容
- HTTPS確認（Vercelで自動対応）
- CSRF対策（Next.js API Routeの標準機能でOK）
- Rate Limit（Bot対策）

---

### フェーズ 4: メンテナンス性向上
**目的**：コードの分離と再利用性

#### 作業内容
- デフォルトアイテムを別ファイル管理（`/lib/items.ts`）
- 型定義（TypeScript厳格化）
- 環境変数の型安全化（`zod`やNext.jsの`env`機能利用）

